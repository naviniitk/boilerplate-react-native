name: production_on_push

on:
  push:
    branches:
      - main

jobs:
  # sonarqube:
  #   name: analyze
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #       with:
  #         # Disabling shallow clone is recommended for improving relevancy of reporting
  #         fetch-depth: 0
      
  #     - name: sonarqube-scan-branch
  #       uses: sonarsource/sonarqube-scan-action@master
  #       env:
  #         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
  #         SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
  #       with:
  #         args: >
  #           -Dsonar.branch.name=${{ github.event.ref }}

  checks:
    runs-on: ubuntu-latest
    strategy:
      # turn off fail fast, let all the checks run irrespective of failures
      fail-fast: false
      matrix:
        check: ['yarn:lint', 'compose:test']
    steps:
      - name: Checkout (app)
        uses: actions/checkout@v2
        # with:
        #   path: app
      - uses: actions/setup-node@v1
        with:
          node-version: "16.x"

      # - uses: ruby/setup-ruby@v1
      #   with:
      #    ruby-version: '3.1.2'

      # - name: Install Fastlane
      #   run: cd android && bundle install && cd ..

      - name: Install packages
        run: yarn install

      - name: Run check
        uses: ./app/.github/actions/check
        with:
          check: ${{ matrix.check }}
